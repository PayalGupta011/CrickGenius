<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart & Checkout - CrickGenius</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <script>
        if (!localStorage.getItem('isLoggedIn')) {
            window.location.href = 'login.html';
        }
    </script>
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">
                <i class="fas fa-cricket"></i>
                <span>CrickGenius</span>
            </a>

            <div class="hamburger" onclick="document.querySelector('.nav-links').classList.toggle('active')">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="merchandise.html">Merchandise</a>
                <a href="cart.html" class="active">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <a href="profile.html">
                    <i class="fas fa-user-circle"></i>
                </a>
            </nav>
        </div>
    </header>

    <div class="container" style="padding: 60px 20px;">

        <!-- Steps Indicator -->
        <div class="glass glass-card mb-20" style="display: flex; justify-content: space-around; padding: 20px;">
            <div id="step1" class="step-indicator" style="color: var(--success); font-weight: bold;">1. Cart</div>
            <div id="step2" class="step-indicator" style="color: var(--text-secondary);">2. Shipping</div>
            <div id="step3" class="step-indicator" style="color: var(--text-secondary);">3. Payment</div>
        </div>

        <!-- View 1: Cart Items -->
        <div id="cartView">
            <h2 class="section-title" style="margin-top: 0;">Your Cart</h2>
            <div id="cartContent"></div>
        </div>

        <!-- View 2: Shipping Form -->
        <div id="shippingView" class="d-none">
            <div class="glass glass-card" style="max-width: 600px; margin: 0 auto;">
                <h2 style="margin-bottom: 20px;">Shipping Details</h2>
                <form id="shippingForm">
                    <div class="input-group">
                        <input type="text" placeholder="Full Name" required
                            style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                    </div>
                    <div class="input-group">
                        <input type="text" placeholder="Address Line 1" required
                            style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                    </div>
                    <div class="input-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" placeholder="City" required
                            style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                        <input type="text" placeholder="ZIP Code" required
                            style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                    </div>
                    <div class="input-group">
                        <input type="tel" placeholder="Phone Number" required
                            style="width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <button type="button" class="btn btn-secondary" onclick="showCart()">Back</button>
                        <button type="submit" class="btn btn-primary">Proceed to Payment</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- View 3: Payment -->
        <div id="paymentView" class="d-none">
            <div class="glass glass-card" style="max-width: 600px; margin: 0 auto;">
                <h2 style="margin-bottom: 20px;">Payment Method</h2>

                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px; cursor: pointer;">
                        <input type="radio" name="paymentMethod" value="online" checked
                            onchange="togglePaymentFields()">
                        <span>Online Payment (Credit/Debit Card)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="radio" name="paymentMethod" value="cod" onchange="togglePaymentFields()">
                        <span>Cash on Delivery</span>
                    </label>
                </div>

                <div id="cardDetails" class="animate">
                    <h4 style="margin-bottom: 10px; color: var(--accent);">Enter Card Details</h4>
                    <input type="text" placeholder="Bank Name"
                        style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                    <input type="text" placeholder="Card Number"
                        style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" placeholder="MM/YY"
                            style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                        <input type="password" placeholder="CVV"
                            style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white;">
                    </div>
                </div>

                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="showShipping()">Back</button>
                    <button type="button" class="btn btn-primary" onclick="processPayment()">Complete Order</button>
                </div>
            </div>
        </div>

        <!-- View 4: Success -->
        <div id="successView" class="d-none glass glass-card text-center animate"
            style="max-width: 500px; margin: 0 auto;">
            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 20px;"></i>
            <h2>Order Placed Successfully!</h2>
            <p>Thank you for shopping with CrickGenius. Your order has been confirmed.</p>
            <a href="index.html" class="btn btn-primary mt-20">Return Home</a>
        </div>

    </div>

    <script>
        let cart = JSON.parse(localStorage.getItem('cart')) || [];

        function updateSteps(step) {
            document.getElementById('step1').style.color = step >= 1 ? 'var(--success)' : 'var(--text-secondary)';
            document.getElementById('step2').style.color = step >= 2 ? 'var(--success)' : 'var(--text-secondary)';
            document.getElementById('step3').style.color = step >= 3 ? 'var(--success)' : 'var(--text-secondary)';
        }

        function loadCart() {
            const cartContent = document.getElementById('cartContent');
            const cartCount = document.getElementById('cartCount');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;

            if (cart.length === 0) {
                cartContent.innerHTML = `
                    <div class="glass glass-card text-center text-secondary">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>Your cart is empty</h3>
                        <a href="merchandise.html" class="btn btn-primary mt-20">Shop Now</a>
                    </div>`;
                return;
            }

            let subtotal = 0;
            let html = '<div class="product-grid" style="grid-template-columns: 1fr;">';

            cart.forEach(item => {
                subtotal += item.price * item.quantity;
                html += `
                    <div class="glass glass-card cart-item">
                        <div style="display:flex; align-items:center; gap:20px;">
                            <img src="${item.image}" style="width:80px; height:80px; border-radius:8px; object-fit:cover;">
                            <div>
                                <h3>${item.name}</h3>
                                <p style="margin:0; color:var(--success);">₹${item.price}</p>
                            </div>
                        </div>
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <button class="btn btn-secondary" onclick="updateQty(${item.id}, -1)" style="padding:5px 12px;">-</button>
                                <span>${item.quantity}</span>
                                <button class="btn btn-secondary" onclick="updateQty(${item.id}, 1)" style="padding:5px 12px;">+</button>
                            </div>
                            <i class="fas fa-trash" style="color:var(--danger); cursor:pointer;" onclick="removeItem(${item.id})"></i>
                        </div>
                    </div>
                `;
            });

            html += '</div>';

            html += `
                <div class="glass glass-card mt-20" style="text-align:right;">
                    <h3>Total: ₹${subtotal}</h3>
                    <button class="btn btn-primary mt-20" onclick="showShipping()">Proceed to Checkout</button>
                </div>
            `;

            cartContent.innerHTML = html;
        }

        function updateQty(id, change) {
            const item = cart.find(i => i.id === id);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) cart = cart.filter(i => i.id !== id);
                localStorage.setItem('cart', JSON.stringify(cart));
                loadCart();
            }
        }

        function removeItem(id) {
            cart = cart.filter(i => i.id !== id);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCart();
        }

        function showShipping() {
            document.getElementById('cartView').classList.add('d-none');
            document.getElementById('paymentView').classList.add('d-none');
            document.getElementById('shippingView').classList.remove('d-none');
            updateSteps(2);
        }

        function showCart() {
            document.getElementById('shippingView').classList.add('d-none');
            document.getElementById('cartView').classList.remove('d-none');
            updateSteps(1);
        }

        document.getElementById('shippingForm').addEventListener('submit', (e) => {
            e.preventDefault();
            document.getElementById('shippingView').classList.add('d-none');
            document.getElementById('paymentView').classList.remove('d-none');
            updateSteps(3);
        });

        function togglePaymentFields() {
            const method = document.querySelector('input[name="paymentMethod"]:checked').value;
            const cardDetails = document.getElementById('cardDetails');
            if (method === 'online') cardDetails.classList.remove('d-none');
            else cardDetails.classList.add('d-none');
        }

        function processPayment() {
            // Simulate processing
            const btn = document.querySelector('#paymentView .btn-primary');
            const originalText = btn.innerText;
            btn.innerText = "Processing...";
            btn.disabled = true;

            setTimeout(() => {
                // Save Order History
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                orders.push({
                    date: new Date().toLocaleDateString(),
                    items: cart,
                    total: cart.reduce((acc, item) => acc + item.price * item.quantity, 0)
                });
                localStorage.setItem('orders', JSON.stringify(orders));

                // Clear Cart
                localStorage.removeItem('cart');

                document.getElementById('paymentView').classList.add('d-none');
                document.getElementById('successView').classList.remove('d-none');
            }, 2000);
        }

        loadCart();
    </script>
</body>

</html>