<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stadium Ticket Booking - CrickGenius</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .booking-hero {
            padding: 80px 0;
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?ixlib=rb-1.2.1&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            text-align: center;
            border-radius: 0 0 30px 30px;
            margin-bottom: 40px;
        }

        .match-details {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            border-radius: 15px;
            display: inline-block;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Wrapper for scrolling stadium on mobile */
        .stadium-scroll-wrapper {
            width: 100%;
            overflow-x: auto;
            padding-bottom: 20px;
            -webkit-overflow-scrolling: touch;
            display: flex;
            justify-content: center;
        }

        .container{
            overflow: visible;
            margin-left: 200px;
        }

        /* Ensure stadium container is fixed size inside wrapper */
        .stadium-container {
            perspective: 1000px;
            margin-bottom: 60px;
            padding: 40px 20px;
            text-align: center;
            background: radial-gradient(circle at center, rgba(56, 176, 0, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            width: 800px;
            /* Fixed width */
            min-width: 800px;
            /* Ensure it doesn't shrink */
            height: 800px;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transform: scale(0.9);
            /* Slight scale down to fit better */
            transform-origin: center top;
        }

        @media (max-width: 768px) {
            .stadium-scroll-wrapper {
                justify-content: flex-start;
                /* Allow scroll from left */
            }

            .stadium-container {
                transform: scale(0.65);
                /* Scale down for mobile */
                transform-origin: left top;
                margin-left: 20px;
                margin-bottom: -200px;
                /* Adjust spacing after scaling */
            }

            .booking-hero h1 {
                font-size: 2rem;
            }
        }

        .pitch {
            width: 120px;
            height: 200px;
            background: #d4e157;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(0, 0, 0, 0.5);
            font-weight: bold;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .pitch::before,
        .pitch::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.8);
        }

        .pitch::before {
            top: 20px;
        }

        .pitch::after {
            bottom: 20px;
        }

        .stand {
            position: absolute;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 5px;
        }

        /* North Stand (Top) */
        .stand-north {
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
        }

        /* South Stand (Bottom) */
        .stand-south {
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
        }

        /* West Stand (Left) */
        .stand-west {
            left: 50px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
            width: 400px;
        }

        /* East Stand (Right) */
        .stand-east {
            right: 50px;
            top: 50%;
            transform: translateY(-50%) rotate(90deg);
            width: 400px;
        }

        .stand-label {
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .seat {
            height: 20px;
            width: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px 4px 10px 10px;
            /* Chair shape */
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .seat:hover:not(.occupied) {
            transform: scale(1.3);
            background: var(--success);
            z-index: 10;
        }

        .seat.selected {
            background: var(--success);
            box-shadow: 0 0 10px var(--success);
            transform: scale(1.1);
        }

        .seat.occupied {
            background: var(--danger);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .booking-summary {
            position: sticky;
            bottom: 0;
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* Modal tweaks for specific requirements */
        .payment-modal h2 {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }

        @media (max-width: 768px) {
            .seat {
                height: 25px;
                width: 25px;
            }

            .seat-map {
                gap: 6px;
                padding: 0 10px;
            }

            .booking-hero h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <script>
        if (!localStorage.getItem('isLoggedIn')) {
            window.location.href = 'login.html';
        }
    </script>
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">
                <i class="fas fa-cricket"></i>
                <span>CrickGenius</span>
            </a>

            <div class="hamburger" onclick="document.querySelector('.nav-links').classList.toggle('active')">
                <span></span>
                <span></span>
                <span></span>
            </div>

            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="merchandise.html">Merchandise</a>
                <a href="booking.html" class="active">Tickets</a>
                <a href="cart.html">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count nav-icon-badge" id="cartCount">0</span>
                </a>
                <a href="profile.html">
                    <i class="fas fa-user-circle"></i>
                </a>
            </nav>
        </div>
    </header>

    <div class="booking-hero">
        <h1 class="animate">IPL Final 2026</h1>
        <div class="match-details animate" style="animation-delay: 0.2s;">
            <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 5px;">India vs Australia</div>
            <div style="color: var(--success); margin-bottom: 5px;">
                <i class="far fa-calendar-alt"></i> 10th May 2026 | <i class="far fa-clock"></i> 19:30 IST
            </div>
            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                <i class="fas fa-map-marker-alt"></i> Wankhede Stadium, Mumbai
            </div>
        </div>
    </div>

    <div class="container" style="max-width: 900px; padding: 0 20px 100px;">

        <!-- Legend -->
        <div class="legend glass glass-card">
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(255,255,255,0.2);"></div> Available
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: var(--success);"></div> Selected
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: var(--danger); opacity: 0.6;"></div> Occupied
            </div>
        </div>

        <!-- Stadium Layout -->
        <div class="stadium-scroll-wrapper">
            <div class="stadium-container">
                <div class="pitch">PITCH</div>

                <div class="stand stand-north" id="standNorth">
                    <div class="stand-label">North Pavilion</div>
                    <!-- Seats JS -->
                </div>

                <div class="stand stand-south" id="standSouth">
                    <div class="stand-label">South End</div>
                    <!-- Seats JS -->
                </div>

                <div class="stand stand-east" id="standEast">
                    <div class="stand-label">East Stand</div>
                    <!-- Seats JS -->
                </div>

                <div class="stand stand-west" id="standWest">
                    <div class="stand-label">West Stand</div>
                    <!-- Seats JS -->
                </div>
            </div>
        </div>

        <div style="text-align: center; color: var(--text-secondary); margin-bottom: 40px;">
            <p>Click on seats to select them. Price per seat: <span
                    style="color: var(--success); font-weight: bold;">₹1500</span></p>
        </div>

    </div>

    <!-- Sticky Booking Summary -->
    <div class="booking-summary">
        <div class="header-content" style="max-width: 900px; align-items: center;">
            <div style="flex:1;">
                <div style="font-size: 0.9rem; color: var(--text-secondary);">Selected Seats (<span
                        id="seatCount">0</span>)</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: white;">Total: ₹<span id="totalPrice">0</span>
                </div>
            </div>
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-secondary" onclick="clearSelection()" id="cancelBtn" style="display:none;">
                    Cancel
                </button>
                <button class="btn btn-primary" id="bookBtn" disabled onclick="openPaymentModal()">
                    Book Now
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal-overlay" id="paymentModal">
        <div class="modal payment-modal">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin:0;">Confirm Booking</h2>
                <i class="fas fa-times" onclick="closePaymentModal()"
                    style="cursor: pointer; color: var(--text-secondary);"></i>
            </div>

            <div style="margin-bottom: 25px;">
                <div class="glass" style="padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Match:</span>
                        <strong>Ind vs Aus</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Date:</span>
                        <span>10 May 2026</span>
                    </div>
                    <div
                        style="display: flex; justify-content: space-between; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; margin-top: 10px;">
                        <span>Total Payable:</span>
                        <span style="color: var(--success); font-weight: bold; font-size: 1.2rem;">₹<span
                                id="modalTotal">0</span></span>
                    </div>
                </div>

                <p style="margin-bottom: 10px; color: var(--warning); font-size: 0.9rem;">
                    <i class="fas fa-exclamation-triangle"></i> Only Online Payment is available currently.
                </p>

                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px;">Card Information</label>

                    <input type="text" id="cardName" placeholder="Cardholder Name" class="form-control"
                        style="width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">

                    <input type="text" id="cardNumber" placeholder="Card Number" class="form-control" maxlength="16"
                        style="width: 100%; padding: 12px; margin-bottom: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">

                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="cardExpiry" placeholder="MM/YY" maxlength="5"
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                        <input type="password" id="cardCvv" placeholder="CVV" maxlength="3"
                            style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white;">
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" style="width: 100%;" onclick="processBooking()">Pay & Book</button>
        </div>
    </div>

    <!-- Success Popup -->
    <div class="modal-overlay" id="successModal">
        <div class="modal text-center">
            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 20px;"></i>
            <h2>Booking Confirmed!</h2>
            <p>Your tickets have been sent to your email.</p>
            <p class="text-secondary">See you at the stadium!</p>
            <button class="btn btn-primary mt-20" onclick="window.location.href='index.html'">Go Home</button>
        </div>
    </div>

    <script>
        const seatPrice = 1500;
        let selectedSeats = [];

        // Generate Seats
        function generateSeats() {
            // Randomly occupy some seats
            const occupiedSeats = [2, 5, 8, 12, 19, 20, 35, 45, 46, 60, 61, 88, 92, 110, 115];

            const stands = ['standNorth', 'standSouth', 'standEast', 'standWest'];

            stands.forEach(standId => {
                const container = document.getElementById(standId);
                // Generate 40 seats per stand (4 rows of 10 for example)
                const seatsPerStand = 40;

                for (let i = 1; i <= seatsPerStand; i++) {
                    const absId = standId + '-' + i; // unique ID
                    const seat = document.createElement('div');
                    seat.classList.add('seat');

                    // Simple random occupancy logic using seat ID hash or something
                    if (Math.random() < 0.2) {
                        seat.classList.add('occupied');
                    } else {
                        seat.addEventListener('click', () => toggleSeat(seat, absId));
                    }

                    container.appendChild(seat);
                }
            });
        }

        function toggleSeat(seat, id) {
            if (seat.classList.contains('selected')) {
                seat.classList.remove('selected');
                selectedSeats = selectedSeats.filter(s => s !== id);
            } else {
                seat.classList.add('selected');
                selectedSeats.push(id);
            }
            updateSummary();
        }

        function updateSummary() {
            const count = selectedSeats.length;
            const total = count * seatPrice;

            document.getElementById('seatCount').textContent = count;
            document.getElementById('totalPrice').textContent = total;
            document.getElementById('modalTotal').textContent = total;

            const bookBtn = document.getElementById('bookBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            if (count > 0) {
                bookBtn.disabled = false;
                bookBtn.classList.remove('btn-secondary'); // fallback
                bookBtn.classList.add('btn-primary');
                cancelBtn.style.display = 'block';
            } else {
                bookBtn.disabled = true;
                cancelBtn.style.display = 'none';
            }
        }

        function clearSelection() {
            selectedSeats = [];
            const seats = document.querySelectorAll('.seat.selected');
            seats.forEach(s => s.classList.remove('selected'));
            updateSummary();
        }

        function openPaymentModal() {
            document.getElementById('paymentModal').classList.add('active');
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }

        function processBooking() {
            const btn = document.querySelector('.payment-modal .btn-primary');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            btn.disabled = true;

            setTimeout(() => {
                // Save to LocalStorage for Profile History
                const orders = JSON.parse(localStorage.getItem('orders') || '[]');
                const total = selectedSeats.length * seatPrice;

                orders.push({
                    date: new Date().toLocaleDateString(),
                    items: [{
                        name: `IPL Ticket: IND vs AUS (Seats: ${selectedSeats.join(', ')})`,
                        quantity: 1, // Treat as 1 distinct booking item
                        price: total,
                        image: "https://images.unsplash.com/photo-1540747913346-19e32dc3e97e?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" // Dummy image for profile
                    }],
                    total: total,
                    status: 'Confirmed'
                });

                localStorage.setItem('orders', JSON.stringify(orders));

                document.getElementById('paymentModal').classList.remove('active');
                document.getElementById('successModal').classList.add('active');
            }, 2000);
        }

        // Initialize
        generateSeats();

        // Cart count init (reusing logic if needed, dummy for now to match header)
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        document.getElementById('cartCount').textContent = cart.reduce((sum, item) => sum + item.quantity, 0);

        // Payment Modal Validation
        const cardNameInput = document.getElementById('cardName');
        if (cardNameInput) {
            cardNameInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/[^a-zA-Z\s]/g, '');
            });
        }

        const cardNumInput = document.getElementById('cardNumber');
        if (cardNumInput) {
            cardNumInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/\D/g, '');
            });
        }

        const cardExpInput = document.getElementById('cardExpiry');
        if (cardExpInput) {
            cardExpInput.addEventListener('input', function (e) {
                let value = this.value.replace(/[^\d]/g, '');
                if (value.length >= 2) {
                    value = value.slice(0, 2) + '/' + value.slice(2, 4);
                }
                this.value = value;
            });
        }

        const cardCvvInput = document.getElementById('cardCvv');
        if (cardCvvInput) {
            cardCvvInput.addEventListener('input', function (e) {
                this.value = this.value.replace(/\D/g, '');
            });
        }

    </script>
</body>

</html>